app: lexet
ingredients:
  dist: bionic
  # sources:
  #   - deb http://archive.ubuntu.com/ubuntu/ bionic main universe
  #   - deb http://archive.ubuntu.com/ubuntu/ bionic-updates universe
  #   - deb http://archive.ubuntu.com/ubuntu bionic main
  #   - deb http://archive.ubuntu.com/ubuntu bionic-updates main
  #   - deb http://archive.ubuntu.com/ubuntu bionic-security main
  #   - deb http://archive.ubuntu.com/ubuntu/ bionic main restricted
  #   - deb http://archive.ubuntu.com/ubuntu/ bionic-updates main restricted
  #   - deb http://archive.ubuntu.com/ubuntu/ bionic multiverse
  #   - deb http://archive.ubuntu.com/ubuntu/ bionic-updates multiverse
  #   - deb http://security.ubuntu.com/ubuntu bionic-security main
  #   - deb http://security.ubuntu.com/ubuntu bionic-security main restricted
  #   - deb http://security.ubuntu.com/ubuntu bionic-security universe
  #   - deb http://security.ubuntu.com/ubuntu bionic-security multiverse
  #   - deb http://archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse
  # ppas:
  #   - ubuntu-elisp/ppa
  # packages:
  #   - python3-venv
  #   - python3-pip
  #   - python3
  #   - php-cli
  #   - emacs-snapshot
  #   - pylint3
  #   - shellcheck
  pretend:
    - libgbm1 19.0.8-0ubuntu0~18.04.2
    - libwebkit2gtk-4.0-37 2.24.4-0ubuntu0.18.04.1
    - libegl1 1.0.0-2ubuntu2.3
  script:
    - cwd=$(pwd)
    - [ -d ${cwd}/.home ] || mkdir --verbose ${cwd}/.home
    - [ -f ./mu.codewith.editor.png ] || wget -c https://raw.githubusercontent.com/mu-editor/mu/master/conf/mu.codewith.editor.png
    - [ -f ./lexet.png ] || cp ./mu.codewith.editor.png ./lexet.png

script:
  - cwd=$(pwd)
  - echo "current directory = '${cwd}'"

  # copy appimage entrypoint script
  - cp ../../AppRun ./AppRun
  - chmod a+x ./AppRun

  - [ -d ${cwd}/env ] || mkdir --verbose ${cwd}/env
  - [ -d ${cwd}/init ] || mkdir --verbose ${cwd}/init

  # import sripts lib
  - source $through_point/scripts/index.sh

  # install utils
  - install_utils --root ${cwd} --home ${cwd}/../.home

  # copy lexet app
  - cp -r ../../src ./lexet

  # copy configs
  - cp -r ../../config ./config

  # create emacs link
  # - ln -s ./emacs-snapshot ./usr/bin/emacs

  # prepare icon
  - cp ../lexet.png ./lexet.png
  - ln -s ./lexet.png ./usr/share/icons/hicolor/256x256/

  # build desktop file
  - create_lexet_desktop_file --name ./lexet.desktop

  # - ln -s ./lexet.desktop ./usr/share/applications/lexet.desktop
